<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AdaptBTC Wallet Generator</title>

<!-- Load correct Bitcoin libraries (must be in this order) -->
<script src="https://unpkg.com/tiny-secp256k1@2.2.1/dist/tiny-secp256k1.umd.js"></script>
<script src="https://unpkg.com/bitcoinjs-lib@6.1.5/dist/bitcoinjs-lib.js"></script>

<script>
    bitcoinjs.initEccLib(tinySecp256k1);
</script>

<script src="https://unpkg.com/bip39@3.0.4/dist/index.browser.js"></script>
<script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>

<style>
body {
  background: #ffffff;
  font-family: Arial, sans-serif;
  padding: 20px;
  color: #111;
}

.container {
  max-width: 700px;
  margin: auto;
  padding: 25px;
  border-radius: 12px;
  background: white;
  border: 1px solid #e0e0e0;
}

h1 {
  text-align: center;
  color: #0066ff;
  margin-top: 0;
}

.subtitle {
  text-align: center;
  color: #555;
  margin-bottom: 30px;
}

.output {
  padding: 12px;
  background: #f7f7f7;
  border-radius: 8px;
  margin-bottom: 10px;
  word-break: break-word;
}

button {
  background: #0066ff;
  color: white;
  padding: 10px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 15px;
}

button:hover {
  background: #004ccc;
}

.generate-btn, .restore-btn, .download-btn {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 10px;
}

textarea {
  width: 100%;
  padding: 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 15px;
  min-height: 70px;
  resize: none;
}
</style>
</head>

<body>
<div class="container">

  <h1>AdaptBTC Wallet Generator</h1>
  <p class="subtitle">Create, restore, and explore Bitcoin wallets safely.</p>

  <!-- CREATE NEW WALLET -->
  <button class="generate-btn" onclick="generateWallet()">Generate New Wallet</button>

  <h3>Bitcoin Address</h3>
  <div class="output" id="address"></div>
  <button onclick="copyText('address')">Copy</button>
  <canvas id="qr"></canvas>

  <h3>12-Word Seed Phrase</h3>
  <div class="output" id="seed"></div>
  <button onclick="copyText('seed')">Copy</button>

  <h3>Private Key (WIF)</h3>
  <div class="output" id="private"></div>
  <button onclick="copyText('private')">Copy</button>

  <button class="download-btn" onclick="downloadBackup()">Download Backup</button>

  <hr style="margin: 40px 0;">

  <!-- RESTORE WALLET -->
  <h2>Restore a Wallet</h2>

  <textarea id="restoreInput" placeholder="Enter 12-word seed phrase..."></textarea>
  <button class="restore-btn" onclick="restoreWallet()">Restore Wallet</button>

  <h3>Restored Address</h3>
  <div class="output" id="restoredAddress"></div>

  <h3>Restored Private Key</h3>
  <div class="output" id="restoredPrivate"></div>

  <canvas id="qrRestore"></canvas>

</div>

<script>

// CREATE NEW WALLET ---------------------------------------------------
async function generateWallet() {
    const seedPhrase = bip39.generateMnemonic(128);
    const seed = await bip39.mnemonicToSeed(seedPhrase);
    const hash = bitcoinjs.crypto.sha256(seed);

    const keyPair = bitcoinjs.ECPair.fromPrivateKey(hash);
    const privateKeyWIF = keyPair.toWIF();

    const { address } = bitcoinjs.payments.p2pkh({
        pubkey: keyPair.publicKey
    });

    document.getElementById("seed").textContent = seedPhrase;
    document.getElementById("private").textContent = privateKeyWIF;
    document.getElementById("address").textContent = address;

    new QRious({
        element: document.getElementById("qr"),
        value: address,
        size: 200
    });
}

// COPY TO CLIPBOARD ---------------------------------------------------
function copyText(id) {
    navigator.clipboard.writeText(
        document.getElementById(id).textContent
    );
}

// DOWNLOAD BACKUP -----------------------------------------------------
function downloadBackup() {
    const data =
`AdaptBTC Wallet Backup
======================
Address: ${address.textContent}
Seed Phrase: ${seed.textContent}
Private Key: ${private.textContent}

KEEP THIS FILE SAFE.`;

    const blob = new Blob([data], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "AdaptBTC-Wallet-Backup.txt";
    a.click();
}

// RESTORE WALLET FROM SEED --------------------------------------------
async function restoreWallet() {
    let phrase = document.getElementById("restoreInput").value.trim();

    if (!bip39.validateMnemonic(phrase)) {
        alert("Invalid seed phrase. Make sure it's 12 words.");
        return;
    }

    const seed = await bip39.mnemonicToSeed(phrase);
    const hash = bitcoinjs.crypto.sha256(seed);

    const keyPair = bitcoinjs.ECPair.fromPrivateKey(hash);
    const privateKeyWIF = keyPair.toWIF();

    const { address } = bitcoinjs.payments.p2pkh({
        pubkey: keyPair.publicKey
    });

    document.getElementById("restoredAddress").textContent = address;
    document.getElementById("restoredPrivate").textContent = privateKeyWIF;

    new QRious({
        element: document.getElementById("qrRestore"),
        value: address,
        size: 200
    });
}

</script>

</body>
</html>
